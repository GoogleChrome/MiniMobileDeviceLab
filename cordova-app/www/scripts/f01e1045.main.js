"use strict";function DeviceLabConfig(){var a="http://device-lab.appspot.com";this.url=a}function DeviceController(){function a(a){var d=window.device.platform,e=-1;if("android"===d.toLowerCase()?e=0:"iphone"===d.toLowerCase()&&(e=1),-1===e)return void console.log("Tried to register a device which isn't android or iPhone!?!?");var f={name:window.device.model,nickname:c(),platformId:e,platformVersion:window.device.version,uuid:window.device.uuid},g=b();"undefined"!=typeof g&&null!==g&&(f.deviceId=g),a(f)}function b(){return d()?localStorage.getItem("device-id"):void 0}function c(){return d()?localStorage.getItem("device-nickname"):window.device.model}function d(){return Modernizr&&Modernizr.localstorage}this.saveDevice=function(a){d()&&localStorage.setItem("device-id",a.deviceId)},this.getDevice=function(b,c){"undefined"!=typeof window.device?a(b,c):document.addEventListener("deviceready",function(){a(b,c)},!1)}}function RegistrationController(){function a(a,e,f,g){console.log("registerWithBackEnd()"),c.getDevice(function(c){var h=new XMLHttpRequest;h.open("POST",d.url+"/devicelab/devices/register/",!0),h.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),h.onreadystatechange=b(c,f,g);var i="id_token="+encodeURIComponent(a)+"&gcm_id="+e+"&device_name="+encodeURIComponent(c.name)+"&device_nickname="+encodeURIComponent(c.nickname)+"&platform_id="+encodeURIComponent(c.platformId)+"&platform_version="+encodeURIComponent(c.platformVersion);"undefined"!=typeof c.deviceId&&null!==c.deviceId&&(i+="&device_id="+encodeURIComponent(c.deviceId)),h.send(i)},function(a){g(a)})}function b(a,b,c){return function(){if(4===this.readyState){if(200!==this.status)return console.log("registration-controller: xhr error msg = "+this.responseText),void c(this.responseText);var d=JSON.parse(this.responseText);a.deviceId=d.device_id,b(a)}}}var c=new DeviceController,d=new DeviceLabConfig;this.registerDeviceWithLab=function(b,c,d){console.log("registerDeviceWithLab()"),"undefined"==typeof gcmlaunchbrowser&&d("The GCM Launch Browser plugin hasn't been installed"),gcmlaunchbrowser.getRegistrationId(function(e){a(b,e.regId,c,d)},function(a){"undefined"!=typeof a&&a||(a="An unknown error occurred while setting up push notifications."),d(a)})}}function SignInController(){this.loginInToGPlus=function(a,b){return"undefined"==typeof cordova?void b("Cordova isn't available to the page"):"undefined"==typeof cordova?void b("The NativeGPlusSignIn plugin isn't loaded into the page"):void nativegplussignin.login(function(b){a(b)},function(a){b(a)})}}function HomeController(){function a(a){if(b!==a){var f=document.querySelector(".sign-in"),g=document.querySelector(".home"),h=document.querySelector(".loading");switch(a){case c:h.classList.add("hide"),f.classList.add("hide"),g.classList.remove("hide");break;case d:h.classList.remove("hide"),f.classList.add("hide"),g.classList.add("hide");break;case e:window.location.hash="";var i=new LoginController;i.init()}b=a}}var b,c=0,d=1,e=2;this.logout=function(){a(e)},this.init=function(){var b=document.querySelector(".home > .wrapper > button"),d=this;b.addEventListener("click",function(a){a.preventDefault(),d.logout()},!1),a(c)}}function LoginController(){function a(a){if(c!==a){var b=document.querySelector(".sign-in"),g=document.querySelector(".loading"),h=document.querySelector(".home");switch(a){case e:g.classList.add("hide"),h.classList.add("hide"),b.classList.remove("hide");break;case d:g.classList.remove("hide"),b.classList.add("hide"),h.classList.add("hide");break;case f:window.location.hash="#home";var i=new HomeController;i.init()}c=a}}function b(b){h.registerDeviceWithLab(b,function(b){i.saveDevice(b),a(f)},function(b){a(e),window.alert("Error registering your device for push notifications:\n"+b)})}var c,d=0,e=2,f=3,g=new SignInController,h=new RegistrationController,i=new DeviceController;this.login=function(){a(d),g.loginInToGPlus(function(a){var c=a.id_token;b(c)},function(b){a(e),window.alert("An Error Occured While Loading the Page:\n"+b)})},this.init=function(){var b=document.querySelector(".sign-in > .wrapper > button"),c=this;b.addEventListener("click",function(a){a.preventDefault(),c.login()},!1),a(e)}}function begin(){var a=new LoginController;a.init()}"undefined"!=typeof cordova?document.addEventListener("deviceready",function(){begin()},!1):window.addEventListener("load",function(){begin()},!1);