"use strict";function DeviceLabConfig(){var a="http://198.51.100.227:3000";this.url=a}function DeviceController(){function a(a){var d=window.device.platform,e=-1;if("android"===d.toLowerCase()?e=0:"iphone"===d.toLowerCase()&&(e=1),-1===e)return void console.log("Tried to register a device which isn't android or iPhone!?!?");var f={name:window.device.model,nickname:c(),platformId:e,platformVersion:window.device.version,uuid:window.device.uuid},g=b();"undefined"!=typeof g&&null!==g&&(f.deviceId=g),a(f)}function b(){return d()?localStorage.getItem("device_id"):void 0}function c(){if(!d())return window.device.model;var a=localStorage.getItem("device-nickname");return("undefined"==typeof a||null===a)&&(a=window.device.model),a}function d(){return Modernizr&&Modernizr.localstorage}this.saveDevice=function(a){d()&&localStorage.setItem("device_id",a.device_id)},this.getDevice=function(b,c){"undefined"!=typeof window.device?a(b,c):document.addEventListener("deviceready",function(){a(b,c)},!1)}}function RegistrationController(){function a(a,e,f,g){console.log("registration-controller: registerWithBackEnd()"),c.getDevice(function(c){var h=new XMLHttpRequest;h.open("POST",d.url+"/devices/add/",!0),h.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),h.onreadystatechange=b(c,f,g);var i="id_token="+encodeURIComponent(a)+"&cloud_msg_id="+e+"&device_name="+encodeURIComponent(c.name)+"&device_nickname="+encodeURIComponent(c.nickname)+"&platform_id="+encodeURIComponent(c.platformId)+"&platform_version="+encodeURIComponent(c.platformVersion);"undefined"!=typeof c.deviceId&&null!==c.deviceId&&(i+="&device_id="+encodeURIComponent(c.deviceId)),h.send(i)},function(a){console.log("registration-controller: registerWithBackEnd() Error = "+JSON.stringify(device)),g(a)})}function b(a,b,c){return console.log("getXHRHandler"),function(){if(4===this.readyState){var d=JSON.parse(this.responseText);200!==this.status?c(d.error.msg):(a.device_id=d.data.device_id,b(a))}}}var c=new DeviceController,d=new DeviceLabConfig;this.registerDeviceWithLab=function(b,c,d){return console.log("registration-controller: registerDeviceWithLab() idToken = "+b),"undefined"==typeof gcmlaunchbrowser?void d("The GCM Launch Browser plugin hasn't been installed"):(console.log("registration-controller: Calling getRegistrationId()"),void gcmlaunchbrowser.getRegistrationId(function(e){console.log("registration-controller: getRegistrationId() Success = "+JSON.stringify(e)),a(b,e.regId,c,d)},function(a){console.log("registration-controller: getRegistrationId() Success = "+JSON.stringify(a)),"undefined"!=typeof a&&a||(a="An unknown error occurred while setting up push notifications."),d(a)}))}}function SignInController(){this.loginInToGPlus=function(a,b){return"undefined"==typeof cordova?void b("Cordova isn't available to the page"):"undefined"==typeof cordova?void b("The NativeGPlusSignIn plugin isn't loaded into the page"):(console.log("sign-in-controller: Attempting G+ Sign In"),void nativegplussignin.login(function(b){console.log("sign-in-controller: Success - "+JSON.stringify(b)),a(b)},function(a){console.log("sign-in-controller: Error - "+JSON.stringify(a)),b(a)}))}}function HomeController(){function a(a){if(b!==a){var f=document.querySelector(".sign-in"),g=document.querySelector(".home"),h=document.querySelector(".loading");switch(a){case c:h.classList.add("hide"),f.classList.add("hide"),g.classList.remove("hide");break;case d:h.classList.remove("hide"),f.classList.add("hide"),g.classList.add("hide");break;case e:window.location.hash="";var i=new LoginController;i.init()}b=a}}var b,c=0,d=1,e=2;this.logout=function(){a(e)},this.init=function(){var b=document.querySelector(".home > .wrapper > button"),d=this;b.addEventListener("click",function(a){a.preventDefault(),d.logout()},!1),a(c)}}function LoginController(){function a(a){if(c!==a){var b=document.querySelector(".sign-in"),g=document.querySelector(".loading"),h=document.querySelector(".home");switch(a){case e:g.classList.add("hide"),h.classList.add("hide"),b.classList.remove("hide");break;case d:g.classList.remove("hide"),b.classList.add("hide"),h.classList.add("hide");break;case f:window.location.hash="#home";var i=new HomeController;i.init()}c=a}}function b(b){h.registerDeviceWithLab(b,function(b){console.log("login-ui-controller: Signed In and Device Registered"),i.saveDevice(b),a(f)},function(b){a(e),window.alert("Error registering your device for push notifications:\n"+b)})}var c,d=0,e=2,f=3,g=new SignInController,h=new RegistrationController,i=new DeviceController;this.login=function(){a(d),g.loginInToGPlus(function(a){var c=a.id_token;b(c)},function(b){a(e),window.alert("An Error Occured While Loading the Page:\n"+b)})},this.init=function(){var b=document.querySelector(".sign-in > .wrapper > button"),c=this;b.addEventListener("click",function(a){a.preventDefault(),c.login()},!1),a(e)}}function begin(){var a=new LoginController;a.init()}"undefined"!=typeof cordova?document.addEventListener("deviceready",function(){begin()},!1):console.log("Cordova is not loaded");